/*! sinanbolel 19-07-2015 */
var appModule=angular.module("SinanBolelApp",["trackJs","ui.router","firebase","angularMoment","ngMaterial","layout","home","user","thinkcrazy.server","thinkcrazy.apps"]);appModule.constant("AUTO_ANON",!0),appModule.constant("FBURL","https://sinanbolel.firebaseio.com/"),appModule.config(["$stateProvider","$urlRouterProvider","$logProvider",function(a,b,c){b.otherwise("/"),c.debugEnabled(!1)}]),appModule.run(["$log","$rootScope","$state","$stateParams","ServerService",function(a,b,c,d,e){a.debug("module.SinanBolelApp.run()"),e.ping(),b.$state=c,b.$stateParams=d,b.$on("$stateChangeError",function(b,d,e,f,g,h){"AUTH_REQUIRED"===h?(a.error(h),c.go("user.login")):a.error(h)})}]),appModule.filter("reverse",function(){return function(a){return _.toArray(a).slice().reverse()}}),appModule.service("StateService",["$log","$rootScope","$state","$q","ObjectFactory",function(a,b,c,d,e){var f={getLastChild:function(){var a=c.$current.toString(),b=a.split("."),d=b[b.length-1];return d},loadData:function(){var a=d.defer(),b=f.getLastChild();new e([b],50).then(function(c){var d={contents:c,state:b};a.resolve(d)})["catch"](function(b){a.reject(b)});return a.promise}};return f}]);var adminModule=angular.module("admin",["ui.grid","ui.grid.resizeColumns","tables"]);adminModule.config(["$stateProvider",function(a){a.state("admin",{url:"/admin","abstract":!0,controller:"AdminController",templateUrl:"src/admin/templates/admin.index.html"}).state("admin.index",{url:"",views:{"":{template:"Hello Admin"}}}).state("admin.clients",{url:"/clients",views:{"":{templateUrl:"src/admin/templates/clients.index.html"}}}).state("admin.projects",{url:"/projects",views:{"":{templateUrl:"src/admin/templates/projects.index.html"}}}).state("admin.leads",{url:"/leads",views:{"":{templateUrl:"src/admin/templates/leads.index.html"}}})}]),adminModule.controller("AdminController",["$log","$rootScope","$scope","$state","ObjectFactory","StateService","TableFactory",function(a,b,c,d,e,f,g){var h,i,j=function(){c.tableOptions.data=c[h]};c.init=function(){h=f.getLastChild(),f.loadData().then(function(a){c[h]=a.contents,j()}),i=g[h],c.tableOptions={enableFiltering:!0,columnDefs:i}},c.createObject=function(a){c[h].$add(a)},c.viewObject=function(){},c.editObject=function(){},c.removeObject=function(){}}]),adminModule.controller("AdminCreateController",["$log","$rootScope","$scope","$state",function(a,b,c,d){}]),adminModule.controller("AdminViewController",["$log","$rootScope","$scope","$state",function(a,b,c,d){}]),adminModule.factory("ObjectFactory",["$log","$q","DataObject","FBURL",function(a,b,c,d){return function(e){var f=b.defer();if(e.constructor===Array){var g="/"+e.join("/"),h=new Firebase(d+g);obj=new c(h),obj.$loaded().then(function(){a.debug(g+" loaded."),f.resolve(obj)})}else a.error("Missing listPath."),f.reject("Missing listPath.");return f.promise}}]),adminModule.factory("DataObject",["$firebaseAuth","$firebaseArray","$q","FBURL",function(a,b,c,d){return b.$extend({$$defaults:{}})}]);var tablesModule=angular.module("tables",[]).factory("TableFactory",["uiGridConstants",function(a){var b={leads:[{name:"name",field:"name",displayName:"Name",type:"string"},{field:"email",displayName:"Email",type:"string"},{field:"phone",displayName:"Phone",type:"string"},{name:"message",field:"message",displayName:"Message",type:"string"},{name:"submitDate",field:"submitAt",displayName:"Date",type:"date",cellTemplate:"<span>{{row.entity.submitAt  | amDateFormat:'MM/DD/YY'}}</span>",width:100},{name:"submitTime",field:"submitAt",displayName:"Time",type:"date",cellTemplate:"<span>{{row.entity.submitAt  | amDateFormat:'HH:mm:ss ZZ'}}</span>",width:130},{name:"timestamp",field:"submitAt",displayName:"Timestamp",type:"number",cellTemplate:"<span>{{row.entity.submitAt}}</span>",sort:{direction:a.DESC,priority:0}}],clients:[{name:"active",field:"active",displayName:"Health",headerCellTemplate:'<md-button class="md-icon-button" aria-label="Projects"><i class="ion-ios-lightbulb"></i></md-button>',type:"bool",width:60},{name:"id",field:"$id",displayName:"$id",type:"string"},{name:"name",field:"name",displayName:"Name",type:"string"},{name:"email",field:"email",displayName:"Email",type:"string"},{name:"phone",field:"phone",displayName:"Phone Number",type:"string"},{name:"project",field:"currentProject",displayName:"Current Project",type:"string"},{name:"invited-at",field:"invitedAt",displayName:"Invited",type:"number"},{name:"joined-at",field:"joinedAt",displayName:"Joined",type:"number"}],projects:[{name:"project-name",field:"name",displayName:"Name",type:"string"},{name:"client",field:"client",displayName:"Client",type:"string"},{name:"documents",field:"documents",displayName:"Docs",type:"number"}]};return b}]);String.prototype.condense=function(){return this.replace(/(\r\n|\n|\r)/gm,"")};var appsModule=angular.module("thinkcrazy.apps",["thinkcrazy.apps.requester"]);appsModule.config(["$stateProvider",function(a){a.state("apps",{url:"/apps","abstract":!0,template:"<ui-view/>"}).state("apps.home",{url:"",templateUrl:"src/apps/apps.html"})}]);var requesterModule=angular.module("thinkcrazy.apps.requester.service",[]).service("RequesterService",["$log","$q","$http",function(a,b,c){var d=[],e=function(a,b){return"undefined"!=typeof a?this.url=a:this.url="","undefined"!=typeof b?this.params=b:this.params={},this.response={data:{},status:{},headers:{},config:{}},this.key=d.length,d.push(this),this};return e.prototype.setResponse=function(a,b,c,d){this.response={data:a,status:b,headers:c,config:d}},e.prototype.execute=function(){var a=this,d=b.defer();return("undefined"==typeof this.url||"undefined"==typeof this.params)&&d.reject("Missing request url/params."),c.get(this.url,this.params).success(function(b,c,e,f){a.setResponse(b,c,e,f),d.resolve(b,c,e,f)}).error(function(b,c,e,f){a.setResponse(b,c,e,f),d.reject(b,c,e,f)}),d.promise},e.prototype.cache=function(){},this.getRequestByKey=function(a){return"undefined"!=typeof d[a]?d[a]:null},this.createRequest=function(c,d){var f=b.defer(),g=new e(c,d);return g.execute().then(function(b,c,d,e){a.debug("Completed request:\n",b,c,d,e),f.resolve(b,c,d,e)})["catch"](function(b,c,d,e){a.error("Error completing request\n:",b,c,d,e),f.reject(b,c,d,e)}),f.promise},this}]),requesterModule=angular.module("thinkcrazy.apps.requester",["thinkcrazy.apps.requester.service"]);requesterModule.config(["$stateProvider",function(a){a.state("apps.requester",{url:"/requester",controller:"RequesterAppController",templateUrl:"src/apps/requester/requester.html"})}]),requesterModule.controller("RequesterAppController",["$log","$scope","$http","RequesterService","ServerService",function(a,b,c,d,e){function f(c,d,f){"xml"===d&&"json"===f?e.request.xmlToJson(c).then(function(c){a.debug("convertData.xmlToJson",c),b.requester.$jsonResult=JSON.parse(c.data)}):a.error("Unknown conversion type.")}b.requester={$loading:!1,$requestKeys:[],params:{}},b.makeRequest=function(){b.requester.$loading=!0,d.createRequest(b.requester.url,b.requester.params).then(function(a,c,d,e){b.requester.response=a})["catch"](function(a,c,d,e,f){b.requester.response=c})},b.init=function(){e.ping()},b.xmlToJson=function(){var c=b.requester.response;c?f(c.replace(/(\r\n|\n|\r)/gm,""),"xml","json"):a.error("$scope.requester.response not set")}}]);var homeModule=angular.module("home",[]);homeModule.config(["$stateProvider",function(a){a.state("home",{url:"/","abstract":!0,template:"<ui-view/>"}).state("home.index",{url:"",views:{"":{controller:"HomeController",templateUrl:"src/home/home.html"}}})}]),homeModule.controller("HomeController",["$log","$scope","$mdToast","Lead",function(a,b,c,d){b.leadData={};var e,f=function(){e=new d(b).then(function(a){e=a})},g={bottom:!0,top:!1,left:!0,right:!0},h=function(){return Object.keys(g).filter(function(a){return g[a]}).join(" ")},i=function(){c.show(c.simple().content("Sent!").position(h()).hideDelay(5e3))};b.submit=function(){b.leadData&&e.$submit().then(function(){e.$destroy(),b.leadData.name="",b.leadData.email="",b.leadData.message="",i(),e=null,f()})},f()}]);var layoutModule=angular.module("layout",[]);layoutModule.controller("LayoutCtrl",["$rootScope","$scope","$state","$timeout","$mdSidenav","$mdUtil","$log","LayoutService",function(a,b,c,d,e,f,g,h){function i(a){var b=f.debounce(function(){e(a).toggle().then(function(){g.debug("toggle "+a+" is done")})},300);return b}b.goBack=function(){var b=a.$state.$back;b&&""!=b.name?c.go(b.name):c.go("workspace.home")},b.goTo=function(a){c.go(a)},b.toggleLeft=i("left"),b.toggleRight=i("right")}]).controller("LeftCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("left").close().then(function(){d.debug("close LEFT is done")})}}]).controller("RightCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("right").close().then(function(){d.debug("close RIGHT is done")})}}]),layoutModule.service("LayoutService",["$mdSidenav",function(a){this.toggleRight=function(){a("right").toggle().then(function(){console.debug("toggle RIGHT is done")})},this.toggleLeft=function(){a("left").toggle().then(function(){console.debug("toggle left is done")})}}]);var leadModule=angular.module("user.leads",[]);leadModule.factory("Lead",["$log","$q","$rootScope","$firebaseAuth","LeadFactory","FBURL",function(a,b,c,d,e,f){return function(c){var d=b.defer(),g=new Firebase(f+"/leads"),h=(Firebase.ServerValue.TIMESTAMP,g.push()),i=new e(h);return i.$bindTo(c,"leadData").then(function(){a.debug("Bound lead form."),d.resolve(i)}),d.promise}}]),leadModule.factory("LeadFactory",["$log","$rootScope","$firebaseAuth","$firebaseObject","$q","FBURL",function(a,b,c,d,e,f){new Firebase(f);return d.$extend({$$defaults:{name:null,email:null,message:null},$submit:function(b){return deferred=e.defer(),this.submitAt=Firebase.ServerValue.TIMESTAMP,this.$save().then(function(b){a.debug("Submitted form."),deferred.resolve(b)})["catch"](function(b){a.error(b),deferred.reject(b)}),deferred.promise}})}]);var userFactories=angular.module("user.factories",[]);userFactories.factory("User",["$log","$q","$rootScope","$firebaseAuth","$exceptionHandler","UserFactory","FBURL","trackJs",function(a,b,c,d,e,f,g,h){var i;return function(d){var e=b.defer();if(d.uid){var j=new Firebase(g+"/users/"+d.provider+"/"+d.uid);i=new f(j),h.configure({userId:d.uid}),a.debug("Current user:",i.$id),i.$updateUser(),i.$bindTo(c,"userData").then(function(){c.auth=i.$auth.$getAuth(),e.resolve(i)})}else a.error("User factory did not receive user authentication data."),e.reject("User(userAuth) - userAuth not inputted.");return e.promise}}]),userFactories.factory("UserFactory",["$rootScope","$firebaseAuth","$firebaseObject","$q","FBURL",function(a,b,c,d,e){var f=new Firebase(e);return c.$extend({$$defaults:{$auth:b(f)},$updateUser:function(){var a=d.defer(),b={};return angular.copy(this.$auth.$getAuth(),b),delete b.auth,this.auth=b,b.password&&(this.auth.email=b.password.email),this.$ref().update(this.auth,function(b){b?a.reject(b):a.resolve()}),a.promise},$connectPreviousSession:function(a){this.$ref().child("previousSession").push(a)},$logout:function(){this.$destroy(),this.$auth.$unauth()}})}]);var userModule=angular.module("user",["user.services","user.factories","user.leads"]);userModule.run(["$rootScope","UserService",function(a,b){b.init()}]),userModule.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("user",{url:"","abstract":!0,controller:"UserCtrl",template:"<ui-view/>"}).state("user.profile",{url:"/profile",views:{"":{templateUrl:"src/user/templates/user.profile.html"}},resolve:{currentAuth:function(a){return a.requireAuth()}}}).state("user.signup",{url:"/signup",views:{"":{templateUrl:"src/user/templates/user.signup.html"}}}).state("user.login",{url:"/login",views:{"":{templateUrl:"src/user/templates/user.login.html"}}}).state("user.logout",{url:"/logout",template:"<ui-view/>",controller:function(a,b,c){a.debug("Logging out."),c.logout(),b.go("user.login",{alert:"You have been logged out."})}})}]),userModule.controller("UserCtrl",["$log","$scope","$state","UserService",function(a,b,c,d){var e=function(){alert("Oops, we couldn't log you in.")},f=function(){alert("Please enter your email and password to log in.")};b.incomingUser={},b.loginWithPassword=function(){b.incomingUser.email&&b.incomingUser.password?d.loginWithPassword(b.incomingUser,function(){c.go("workspace.home")},function(b){a.error("Login error:",b),e()}):f()},b.signupWithPassword=function(){b.incomingUser.email&&b.incomingUser.password?d.createUser(b.incomingUser,function(){},function(b){a.error("Signup error:",b),e()}):f()}}]);var userServices=angular.module("user.services",[]).service("UserService",["$log","$rootScope","$firebaseAuth","$firebaseObject","$q","FBURL","User","AUTO_ANON",function(a,b,c,d,e,f,g,h){var i,j,k,l=new Firebase(f);return j=c(l),i={init:function(b,c){j.$getAuth()?g(j.$getAuth()).then(function(b){k=b,a.debug("User loaded",k)}):h===!0&&i.loginAnonymously().then(function(b){g(b).then(function(b){k=b,a.debug("User loaded",k)})})},requireAuth:function(){return j.$requireAuth()},getRef:function(){return k.$ref()},createUser:function(b,c,d){i.logout(),j.$createUser({email:b.email,password:b.password}).then(function(c){return a.debug("Created user:"+c.uid),j.$authWithPassword({email:b.email,password:b.password})}).then(function(a){i.init(),c&&c()})["catch"](function(b){a.error("Error: ",b)})},loginWithPassword:function(b,c,d){i.logout(),j.$authWithPassword({email:b.email,password:b.password}).then(function(b){a.debug("User",b.uid,"logged in."),i.init(),c&&c()})["catch"](function(b){a.error("User login failed:",b),d&&d(b)})},loginAnonymously:function(){var a=e.defer();return j.$authAnonymously().then(function(b){console.debug("User ",b.uid," logged in."),a.resolve(b)})["catch"](function(b){console.error("Authenticating anonymous user failed:",b),a.reject(b)}),a.promise},logout:function(b,c){j.$getAuth()?(k.$logout(),a.debug("User successfully logged out."),b&&b()):(a.debug("User tried to logout but is not logged in."),c&&c())}}}]),serverUtil=angular.module("thinkcrazy.server",[]);serverUtil.constant("SERVER_URL","https://thinkcrazy-dev.herokuapp.com"),serverUtil.constant("PING_PARAMS","?firebase=sinanbolel"),serverUtil.service("ServerService",["$log","$q","$http","SERVER_URL","PING_PARAMS",function(a,b,c,d,e){var f=this;return this.getServerUrl=function(){return d},this.ping=function(f){var g=b.defer(),h=e;return f&&(h+=f),a.debug("Pinging server with params",h),c.get(d+"/ping"+h).success(function(b,c,d,e){a.debug("Server ping",c),g.resolve({data:b,status:c,headers:d,config:e})}).error(function(){a.error("Server ping failed."),g.reject("Server ping failed.")}),g.promise},this.request={xmlToJson:function(e){var f=b.defer(),g={method:"POST",url:d+"/services/xmlToJson",headers:{"Content-Type":void 0},data:e};return c(g).success(function(b,c,d,e){a.debug("server.xmlToJson",c),f.resolve(b)}).error(function(b,c,d,e){a.error("server.xmlToJson",c),f.reject(b,c,d,e)}),f.promise}},f}]);